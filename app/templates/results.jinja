{% extends 'base.jinja' %}
{% set results_page = True if not no_results else Flase %}
{% from 'results_macros.jinja' import photo_zoom_modal %}


{% block content %}
  {% if no_results or results|length == 0 %}
    <div class="text-center py-3 custom-background">
      <h3 class="mx-4 my-4">
        There are no results to show.<br>
        Please, solve at least one case to see the results on this page.<br>
      </h3>
      <h4>
        You can get started by clicking <a href="{{ url_for('welcome.get') }}#mode-selection-section">HERE</a>.<br>
        Your Overall statistics can be seen <a href="{{ url_for('statistics.get') }}">HERE</a>.
      </h4>
    </div>
  {% else %}
    <div class="text-center mx-3 mt-3 mb-4">
      {% if results|length == 1 %}
        {% if percentage == 100 %}
          <h2>Congratulations! Your answer is correct.</h2>
        {% else %}
          <h2>Unfortunately this time your answer was wrong.</h2>
        {% endif %}
      {% else %}
        {% if percentage >= 50 %}
          <h2>Congratulations! You were right <b style="color: green">{{ percentage }}%</b> of the time.</h2>
        {% else %}
          <h2>You were right <b style="color: red">{{ percentage }}%</b> of the time. Please consider trying out educational mode.</h2>
        {% endif %}
      {% endif %}
      <h3>Please consider solving more cases -> <a href="{{ url_for('game.get_post', mode=results[0].game_mode) }}">SOLVE MORE</a></h3>
      <h3>
        If you want to have access to the results later on, click
        <a href="{{ url_for('results.send_email', mode=results[0].game_mode, round_token=results[0].round_token) }}">HERE</a>
        and we will send you email with special link
      </h3>
    </div>

    <div class="row row-cols-1 {{ 'row-cols-md-2' if results|length > 1 else 'mx-2' }} g-4">
    {% for result in results %}
      <div class="col text-center">
        <div class="card {{ 'border-success' if result.answer_correct_bool else 'border-danger' }} h-100 mx-3 my-2">
          <div class="card-header" style="background-color: {{ '#53DB57' if result.answer_correct_bool else '#FB8B84' }}">
            <h5 class="card-title">Patient {{ result.patient_id }} {{ result.sex }}</h5>
          </div>
          <div class="card-body" style="background-color: {{ '#D9FFDA' if result.answer_correct_bool else '#FFDCDC' }}">
            <p class="card-text">
              {% if result.answer_correct_bool %}
                Direction of facial growth:<br><b>{{ result.answer }}</b>
              {% else %}
                Actual direction of facial growth:<br><b>{{ result.correct_answer }}</b><br>
                Your answer:<br>{{ result.answer }}
              {% endif %}
            </p>
            <hr class="mt-2 mb-3">
            <div class="row">
              {% for age, id in result.ort_ids.items() %}
                <div class="col-4 px-1">
                  <div class="card">
                    <img src="{{ url_for('results.get_photo', ort_id=id) }}" class="card-img-top" alt="Photo not found...">
                    <div class="card-footer"><small>At the age of <b>{{ age }}</b></small></div>
                  </div>
                </div>
              {% endfor %}
            </div>

            {{ photo_zoom_modal(result.ort_ids, result.patient_id, result.list_of_age) }}

          </div>
          <div class="card-footer" style="background-color: {{ '#53DB57' if result.answer_correct_bool else '#FB8B84' }}">
            <small>You spent <b class="resultTimeSpent">{{ result.time_spent }}</b> on this case.</small>
          </div>
        </div>
      </div>
    {% endfor %}
    </div>
  {% endif %}
{% endblock %}

{% block scripts %}
  {% if not no_results %}
    <script type="text/javascript" src="{{ url_for('static', filename='js/time_format.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/results.js') }}"></script>
  {% endif %}
{% endblock %}
