{% extends 'base.jinja' %}
{% set results_page = True if not no_results else Flase %}

{% macro photo_zoom_modal(ort_ids, id) %}
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#{{ id }}PhotoModal">
    <i class="bi bi-zoom-in"></i>Zoom in on the photos
  </button>

  <!-- Modal -->
  <div class="modal modal-fullscreen fade" id="{{ id }}PhotoModal" tabindex="-1" aria-labelledby="{{ id }}PhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="{{ id }}PhotoModalLabel">Modal title</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="carouselCaptions{{ id }}" class="carousel slide carousel-fade" data-bs-ride="false">
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#carouselCaptions{{ id }}" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
              <button type="button" data-bs-target="#carouselCaptions{{ id }}" data-bs-slide-to="1" aria-label="Slide 2"></button>
              <button type="button" data-bs-target="#carouselCaptions{{ id }}" data-bs-slide-to="2" aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner">
              {% for age, id in ort_ids.items() %}
                <div class="carousel-item active">
                  <img src="{{ url_for('results.get_photo', ort_id=id) }}" class="img-fluid" alt="Photo not found...">
                  <div class="carousel-caption d-none d-md-block">
                    <h5>At the age of <b>{{ age }}</b></h5>
                  </div>
                </div>
              {% endfor %}
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselCaptions{{ id }}" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselCaptions{{ id }}" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endmacro %}

<!-- TODO - different screen for educational mode (or just one result) -->
{% block content %}
  {% if no_results %}
    <div class="text-center py-3 custom-background">
      <h3 class="mx-4 my-4">
        There are no results to show.<br>
        Please, solve at least one case to see the results on this page.<br>
      </h3>
      <h4>
        You can get started by clicking <a href="{{ url_for('welcome.get') }}#mode-selection-section">HERE</a>.<br>
        Your Overall statistics can be seen <a href="{{ url_for('statistics.get') }}">HERE</a>.
      </h4>
    </div>
  {% else %}
    <div class="text-center mx-3 mt-3 mb-4">
      {% if results|length == 1 %}
        {% if percentage == 100 %}
          <h2>Congratulations! Your answer is correct.</h2>
        {% else %}
          <h2>Unfortunately this time your answer was wrong.</h2>
        {% endif %}
      {% else %}
        {% if percentage >= 50 %}
          <h2>Congratulations! You were right <b style="color: green">{{ percentage }}%</b> of the time.</h2>
        {% else %}
          <h2>You were right <b style="color: red">{{ percentage }}%</b> of the time. Please consider trying out educational mode.</h2>
        {% endif %}
      {% endif %}
    </div>

    <div class="row row-cols-1 row-cols-md-2 g-4">
    {% for result in results %}
      <div class="col text-center">
        <div class="card {{ 'border-success' if result.answer_correct_bool else 'border-danger' }} h-100 mx-3 my-2">
          <div class="card-header" style="background-color: {{ '#53DB57' if result.answer_correct_bool else '#FB8B84' }}">
            <h5 class="card-title">Patient {{ result.patient_id }} {{ result.sex }}</h5>
          </div>
          <div class="card-body" style="background-color: {{ '#D9FFDA' if result.answer_correct_bool else '#FFDCDC' }}">
            <p class="card-text">
              {% if result.answer_correct_bool %}
                Direction of facial growth:<br><b>{{ result.answer }}</b>
              {% else %}
                Actual direction of facial growth:<br><b>{{ result.correct_answer }}</b><br>
                Your answer:<br>{{ result.answer }}
              {% endif %}
            </p>
            <hr class="mt-2 mb-3">
            <div class="row">
              {% for age, id in result.ort_ids.items() %}
                <div class="col-4 px-1">
                  <div class="card">
                    <img src="{{ url_for('results.get_photo', ort_id=id) }}" class="card-img-top" alt="Photo not found...">
                    <div class="card-footer"><small>At the age of <b>{{ age }}</b></small></div>
                  </div>
                </div>
              {% endfor %}
            </div>
            <!-- TODO Zoom in button + modal -->
            {{ photo_zoom_modal(result.ort_ids, result.patient_id) }}
          </div>
          <div class="card-footer" style="background-color: {{ '#53DB57' if result.answer_correct_bool else '#FB8B84' }}">
            <small>You spent <b class="resultTimeSpent">{{ result.time_spent }}</b> on this case.</small>
          </div>
        </div>
      </div>
    {% endfor %}
    </div>
  {% endif %}
{% endblock %}

{% block scripts %}
  {% if not no_results %}
    <script type="text/javascript" src="{{ url_for('static', filename='js/time_script.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/results_script.js') }}"></script>
  {% endif %}
{% endblock %}
